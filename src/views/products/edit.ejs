<!DOCTYPE html>
<html lang="es">

<%- include('../partials/head', {titulo: 'Editar producto' , estilo: 'edit-create' }) %>

    <body>
        <%- include('../partials/header-cart', {user: locals.user ? locals.user : undefined}) %>
            <main>
                <div class="container-market">
                    <h2 class="title-market">Editando <%= product.name %></h2>
                    
                    <form action="/productos/editar/<%= product.id %>?_method=PUT" method="POST" class="row d-flex flex-row g-2 needs-validation formAlert" enctype="multipart/form-data">
                        <div class="col-sm-6 col-12">
                            <label for="name" class="form-label">Nombre del producto:</label>
                            <input type="text" name="name" value="<%= locals.old && old.name ? old.name : product && product.name ? product.name : "" %>" id="name" class="form-control <%= locals.errors && errors.name ? "is-invalid" : "" %>" />
                            <% if (locals.errors && errors.name) { %>
                                <div class="invalid-feedback">
                                    <%= errors.name.msg %>
                                </div>
                            <% } %>
                        </div>
                        <div class="col-sm-6 col-12">
                            <label for="image" class="form-label">Imagen:</label>
                            <input type="file" name="image" id="image" class="form-control <%= locals.errors && errors.image ? "is-invalid" : ""  %>" />
                            <% if (locals.errors && errors.image) { %>
                                <div class="invalid-feedback">
                                    <%= errors.image.msg %>
                                </div>
                            <% } %>
                        </div>
                        <div class="col-sm-6 col-12">
                            <label for="category" class="form-label">Categoría</label>
                            <select class="form-select <%= locals.errors && errors.category ? "is-invalid" : ""  %>" name="category" id="category">
                                <option <%= locals.old && old.category == "" ? "selected" : product && product.id_category == "" ? "selected" : "" %> value="">...</option>
                                <% categories.forEach(category => { %>
                                    <option value="<%= category.id_category %>" <%= locals.old && old.category == category.id_category ? "selected" : product && category.id_category == product.id_category ? "selected" : "" %> ><%= category.name %></option>
                                <% }) %>
                              </select>
                            <% if (locals.errors && errors.category) { %>
                                <div class="invalid-feedback">
                                    <%= errors.category.msg %>
                                </div>
                            <% } %>
                        </div>
                        <div class="d-flex flex-row col-sm-6 col-12">
                            <div class="w-50">
                                <label for="price" class="form-label">Precio:</label>
                                <input type="number" name="price" value="<%= locals.old && old.price ? old.price : product && product.price ? product.price : "" %>" id="price" class="form-control <%= locals.errors && errors.price ? "is-invalid" : "" %>" min="0" />
                                <% if (locals.errors && errors.price) { %>
                                    <div class="invalid-feedback">
                                        <%= errors.price.msg %>
                                    </div>
                                <% } %>
                            </div>
                            <div class="w-50">
                                <label for="stock" class="form-label">Stock:</label>
                                <input type="number" name="stock" value="<%= locals.old && old.stock ? old.stock : product && product.stock ? product.stock : "" %>" id="stock" class="form-control <%= locals.errors && errors.stock ? "is-invalid" : "" %>" min="0" />
                                <% if (locals.errors && errors.stock) { %>
                                    <div class="invalid-feedback">
                                        <%= errors.stock.msg %>
                                    </div>
                                <% } %>
                            </div>
                        </div>
                        <div class="col-sm-6 col-12 d-flex flex-row flex-wrap">
                            <label class="col-12" for="colors">Colores:</label>
                                <select class="form-select mt-3 select-colors <%= locals.errors && errors.colors ? "is-invalid" : ""  %>"  name="color1" id="color1">
                                    <option <%= locals.old && old.color1 == "" ? "selected" : "" %> value="">---</option>
                                    <% colors.forEach(color => { %>
                                        <option value="<%= color.id_color %>" <%= locals.old && old.color1 == color.id_color ? "selected" : product && product.colors[0] && product.colors[0].id_color == color.id_color ? "selected" : ""  %> ><%= color.name %></option>
                                    <% }) %>
                                </select>
                                <select class="form-select mt-3 select-colors <%= locals.errors && errors.colors ? "is-invalid" : ""  %>"  name="color2" id="color2">
                                    <option <%= locals.old && old.color2 == "" ? "selected" : "" %> value="">---</option>
                                    <% colors.forEach(color => { %>
                                        <option value="<%= color.id_color %>" <%= locals.old && old.color2 == color.id_color ? "selected" : product && product.colors[1] && product.colors[1].id_color == color.id_color ? "selected" : "" %>><%= color.name %></option>
                                    <% }) %>
                                </select>
                                <select class="form-select mt-3 select-colors <%= locals.errors && errors.colors ? "is-invalid" : ""  %>"  name="color3" id="color3">
                                    <option <%= locals.old && old.color3 == "" ? "selected" : "" %> value="">---</option>
                                    <% colors.forEach(color => { %>
                                        <option value="<%= color.id_color %>" <%= locals.old && old.color3 == color.id_color ? "selected" : product && product.colors[2] && product.colors[2].id_color == color.id_color ? "selected" : "" %>><%= color.name %></option>
                                    <% }) %>
                                </select>
    
                                <% if (locals.errors && errors.colors) { %>
                                    <div class="invalid-feedback col-12">
                                        <%= errors.colors.msg %>
                                    </div>
                                <% } %>
                            
                        </div>
                        <div class="col-sm-6 col-12">
                            <label for="brand" class="form-label">Marca:</label>
                            <input type="text" name="brand" value="<%= locals.old && old.brand ? old.brand : product && product.brand.name ? product.brand.name : "" %>" id="brand" class="form-control <%= locals.errors && errors.brand ? "is-invalid" : "" %>" />
                            <% if (locals.errors && errors.brand) { %>
                                <div class="invalid-feedback">
                                    <%= errors.brand.msg %>
                                </div>
                            <% } %>
                        </div>
    
                        <div class="col-sm-12 col-12">
                            <label for="description" class="form-label">Descripción:</label>
                            <textarea class="form-control <%= locals.errors && errors.description ? "is-invalid" : "" %>" id="description" name="description" placeholder="Escribe una breve descripcion..."><%= locals.old && old.description ? old.description : product && product.description ? product.description : "" %></textarea>
                            <% if (locals.errors && errors.description) { %>
                                <div class="invalid-feedback">
                                    <%= errors.description.msg %>
                                </div>
                            <% } %>
                        </div>
                        <div class="col-sm-12 m-auto mt-3">
                            <button class="btn btn-dark col-12 p-2 btnAlert">Actualizar producto</button>
                        </div>
                      </form>
                    
                    <form class="col-12 m-auto formAlert" action="/productos/eliminar/<%= product.id %>?_method=DELETE" method="POST">
                        <button class="col-12 btn btn-danger p-2 mt-2 btnAlert">Eliminar producto</button>
                    </form>
                    <a class="col-12 m-auto" href="/productos/crear">
                        <button class="col-12 btn btn-primary p-2 mt-2">Crear un producto</button>
                    </a>
                </div>
            </main>
            <%- include('../partials/footer') %>

    </body>

</html>